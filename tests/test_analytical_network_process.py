import pytest
from algorithm.analytical_network_process import AnalyticalNetworkProcessor


@pytest.fixture
def macro_clusters():
    return [
        {
            "matr": [
                [1.0, 5.0, 3.0],
                [0.2, 1.0, 1. / 3.],
                [1. / 3, 3.0, 1.0],
            ],
            "cluster": 0,
            "directs": [1, 2, 3]
        },
        {
            "matr": [
                [1.0, 3.0],
                [1. / 3, 1.0],
            ],
            "cluster": 1,
            "directs": [2, 3]
        },
        {
            "matr": [
                [1.0],
            ],
            "cluster": 2,
            "directs": [3]
        },
        {
            "matr": [
                [1.0],
            ],
            "cluster": 3,
            "directs": [0]
        }
    ]


@pytest.fixture
def micro_clusters():
    return [
        {
            "cluster": 0,
            "elements": [
                {
                    "element": 0,
                    "directs": [
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                        [
                            [1.0, 2.0, 3.0],
                            [0.5, 1.0, 2.0],
                            [1./3., 0.5, 1.0],
                        ],
                        [
                            [1.0, 3.0, 4.0],
                            [1.0/3.0, 1.0, 3.0],
                            [0.25, 1.0/3., 1.0],
                        ],
                        [
                            [1.0, 2.0, 0.2],
                            [0.5, 1.0, 1.0/6.0],
                            [5.0, 6.0, 1.0],
                        ],
                    ]
                },
                {
                    "element": 1,
                    "directs": [
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                        [
                            [1.0, 2.0, 1.0/3.],
                            [0.5, 1.0, 0.25],
                            [3.0, 4.0, 1.0],
                        ],
                        [
                            [1.0, 0.2, 0.5],
                            [5.0, 1.0, 3.0],
                            [2.0, 1.0/3., 1.0],
                        ],
                        [
                            [1.0, 3.0, 5.0],
                            [1.0 / 3.0, 1.0, 2.0],
                            [0.2, 0.5, 1.0],
                        ],
                    ]
                },
                {
                    "element": 2,
                    "directs": [
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                        [
                            [1.0, 0.5, 2.0],
                            [2.0, 1.0, 3.0],
                            [0.5, 1./3., 1.0],
                        ],
                        [
                            [1.0, 4.0, 0.5],
                            [0.25, 1.0, 0.2],
                            [2.0, 5., 1.0],
                        ],
                        [
                            [1.0, 0.25, 0.5],
                            [4.0, 1.0, 3.0],
                            [2.0, 1./3., 1.0],
                        ],
                    ]
                },
            ]
        },
        {
            "cluster": 1,
            "elements": [
                {
                    "element": 0,
                    "directs": [
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                        [
                            [1.0, 0.5, 2.0],
                            [2.0, 1.0, 3.0],
                            [0.5, 1.0 / 3., 1.0],
                        ],
                        [
                            [1.0, 2.0, 0.2],
                            [0.5, 1.0, 0.25],
                            [5.0, 4.0, 1.0],
                        ],
                    ]
                },
                {
                    "element": 1,
                    "directs": [
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                        [
                            [1.0, 0.5, 0.25],
                            [2.0, 1.0, 1.0/3.],
                            [4.0, 3.0, 1.0],
                        ],
                        [
                            [1.0, 4.0, 5.0],
                            [0.25, 1.0, 2.0],
                            [0.2, 0.5, 1.0],
                        ],
                    ]
                },
                {
                    "element": 2,
                    "directs": [
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                        [
                            [1.0, 4.0, 2.0],
                            [0.25, 1.0, 1.0/3.],
                            [0.5, 3., 1.0],
                        ],
                        [
                            [1.0, 5.0, 6.0],
                            [0.2, 1.0, 4.0],
                            [1.0/6., 0.25, 1.0],
                        ],
                    ]
                },
            ]
        },
        {
            "cluster": 2,
            "elements": [
                {
                    "element": 0,
                    "directs": [
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                        [
                            [1.0, 2.0, 0.25],
                            [0.5, 1.0, 0.2],
                            [4.0, 5.0, 1.0],
                        ],
                    ]
                },
                {
                    "element": 1,
                    "directs": [
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                        [
                            [1.0, 3.0, 2.0],
                            [1./3., 1.0, 3.0],
                            [0.5, 1./3., 1.0],
                        ],
                    ]
                },
                {
                    "element": 2,
                    "directs": [
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                        [
                            [1.0, 5.0, 0.5],
                            [0.2, 1.0, 4.0],
                            [2., 0.25, 1.0],
                        ],
                    ]
                },
            ]
        },
        {
            "cluster": 3,
            "elements": [
                {
                    "element": 0,
                    "directs": [
                        [
                            [1.0, 1.0/3., 0.5],
                            [3., 1.0, 2.],
                            [2.0, 0.5, 1.0],
                        ],
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                    ]
                },
                {
                    "element": 1,
                    "directs": [
                        [
                            [1.0, 0.5, 0.25],
                            [2., 1.0, 1./3.0],
                            [4., 3., 1.0],
                        ],
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                    ]
                },
                {
                    "element": 2,
                    "directs": [
                        [
                            [1.0, 4.0, 5.],
                            [0.25, 1.0, 3.0],
                            [0.2, 1./3., 1.0],
                        ],
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                        [
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                            [0.0, 0.0, 0.0],
                        ],
                    ]
                },
            ]
        }
    ]


@pytest.fixture
def elements():
    return {
        "names": [
            "1.1 Bosch",
            "1.2 Electrolux",
            "1.3 Samsung",
            "2.1 Ёмкость",
            "2.2 Мощность",
            "2.3 Экологичность",
            "3.1 Энергозатраты",
            "3.2 Обслуживание",
            "3.3 Громоздкость щётки",
            "4.1 Стоимость",
            "4.2 Внешний вид",
            "4.3 Компактность",
        ],
        "counts": [3, 3, 3, 3]
    }

def test_calculate(macro_clusters, micro_clusters, elements):
    processor = AnalyticalNetworkProcessor(macro_clusters, micro_clusters)
    processor.calculate(elements)
